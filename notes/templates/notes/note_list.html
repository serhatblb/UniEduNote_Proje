{% extends "notes/base.html" %}
{% block title %}Notlarƒ± Ke≈üfet{% endblock %}

{% block head %}
<style>
  .page-container { max-width:1280px!important; width:100%!important; }
</style>
{% endblock %}

{% block content %}
<style>
  body { background:#f4f6fa; }

  /* === √úST Fƒ∞LTRE ALANI === */
  .filter-section {
    background:#fff;
    border-radius:20px;
    box-shadow:0 6px 18px rgba(0,0,0,0.08);
    padding:2rem;
    margin-bottom:2rem;
    display:flex;
    flex-direction:column;
    gap:1rem;
  }
  .filter-section h3 {
    font-weight:700;
    color:#00205B;
    margin-bottom:.5rem;
  }
  .filter-form {
    display:flex;
    flex-wrap:wrap;
    gap:1rem;
    align-items:flex-end;
  }
  .filter-form label {
    font-weight:600;
    color:#00205B;
    margin-bottom:.3rem;
    font-size:.9rem;
  }
  .filter-form select,
  .filter-form input {
    padding:.5rem .75rem;
    border:1px solid #d1d5db;
    border-radius:8px;
    min-width:180px;
    font-size:.9rem;
  }
  .filter-form button {
    background:#00205B;
    color:#fff;
    border:none;
    padding:.6rem 1.2rem;
    border-radius:8px;
    font-weight:600;
  }
  @media(max-width:768px){
    .filter-form{ flex-direction:column; align-items:stretch; }
    .filter-form select, .filter-form input{ width:100%; }
  }

  /* === ALT NOTLAR GRID === */
  .notes-section {
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));
    gap:1.5rem;
  }
  .note-card {
    background:#fff;
    border-radius:16px;
    padding:1.25rem;
    box-shadow:0 4px 15px rgba(0,0,0,0.07);
    transition:transform .2s, box-shadow .2s;
    cursor:pointer;
  }
  .note-card:hover {
    transform:translateY(-5px);
    box-shadow:0 8px 22px rgba(0,0,0,0.12);
  }
  .note-title { font-size:1.1rem;font-weight:600;color:#00205B;margin-bottom:.4rem; }
  .note-desc { font-size:.9rem;color:#6b7280;margin-bottom:.8rem;min-height:2.2rem; }
  .note-meta { display:flex;flex-wrap:wrap;gap:.4rem;margin-bottom:.8rem; }
  .note-meta span {
    background:#f3f4f6;
    color:#374151;
    padding:.3rem .6rem;
    border-radius:6px;
    font-size:.8rem;
  }
  .note-footer { display:flex;justify-content:space-between;align-items:center; }
  .note-footer small { color:#6b7280; }
  .btn-download {
    background:#10B981;
    color:#fff;
    border:none;
    padding:.4rem .9rem;
    border-radius:8px;
    font-size:.85rem;
    text-decoration:none;
  }
  .empty-state { text-align:center;padding:3rem 1rem;color:#6b7280; }
</style>

<div class="filter-section">
  <h3>üéì Notlarƒ± Filtrele</h3>
  <form method="GET" id="filter-form" class="filter-form">
    <div>
      <label for="filter_university">√úniversite</label>
      {{ filter_form.university }}
    </div>
    <div>
      <label for="filter_department">B√∂l√ºm</label>
      {{ filter_form.department }}
    </div>
    <div>
      <label for="filter_semester">D√∂nem</label>
      {{ filter_form.semester }}
    </div>
    <div>
      <label for="q">Arama</label>
      <input type="text" name="q" id="q" placeholder="Ders, ba≈ülƒ±k..." value="{{ current_search_query }}">
    </div>
    <div><button type="submit">Filtrele</button></div>
  </form>
</div>

{% if notes %}
<div class="notes-section">
  {% for note in notes %}
  <div class="note-card" onclick="window.location.href='{% url 'note_detail' note.id %}'">
    <div class="note-title">{{ note.title }}</div>
    <div class="note-desc">{{ note.description|truncatechars:90 }}</div>
    <div class="note-meta">
      <span>{{ note.course.code }}</span>
      <span>{{ note.course.name }}</span>
      <span>{{ note.course.semester.department.university.name }}</span>
      <span>{{ note.course.semester.department.name }}</span>
    </div>
    <div class="note-footer">
      <small>{{ note.uploader.username }} ‚Ä¢ {{ note.upload_date|date:"d M Y" }}
        <span class="ms-2 text-success fw-bold">‚¨áÔ∏è {{ note.download_count }}</span>
      </small>
      <a href="{% url 'download_note' pk=note.pk %}" class="btn-download">ƒ∞ndir</a>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="empty-state">
  <h4>Hen√ºz hi√ß not y√ºklenmedi</h4>
  <p>Filtreleri sƒ±fƒ±rlayabilir veya yeni not y√ºkleyebilirsin.</p>
  <a href="{% url 'upload_note' %}" class="btn btn-primary mt-2">Not Y√ºkle</a>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function(){
  $("#filter_university").change(function(){
    var id=$(this).val(),dep=$("#filter_department"),sem=$("#filter_semester");
    if(id){
      $.ajax({
        url:"{% url 'ajax_load_departments' %}",
        data:{'university_id':id},dataType:'json',
        success:function(data){
          dep.empty().append('<option value="">T√ºm B√∂l√ºmler</option>');
          sem.empty().append('<option value="">T√ºm D√∂nemler</option>');
          $.each(data,function(k,v){ dep.append('<option value="'+v.id+'">'+v.name+'</option>'); });
        }
      });
    } else {
      dep.empty().append('<option value="">T√ºm B√∂l√ºmler</option>');
      sem.empty().append('<option value="">T√ºm D√∂nemler</option>');
    }
  });

  $("#filter_department").change(function(){
    var id=$(this).val(),sem=$("#filter_semester");
    if(id){
      $.ajax({
        url:"{% url 'ajax_load_semesters' %}",
        data:{'department_id':id},dataType:'json',
        success:function(data){
          sem.empty().append('<option value="">T√ºm D√∂nemler</option>');
          $.each(data,function(k,v){ sem.append('<option value="'+v.id+'">'+v.name+'</option>'); });
        }
      });
    } else {
      sem.empty().append('<option value="">T√ºm D√∂nemler</option>');
    }
  });
});
</script>
{% endblock %}
